# 5. çœ‹æ¿ä¸æµç¨‹èåˆ

## 5.1 æ ¸å¿ƒæ¦‚å¿µæ˜ å°„

```
çœ‹æ¿æ¦‚å¿µ          æµç¨‹æ¦‚å¿µ              å…³ç³»
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Project       â†’  WorkflowRegistry     1ä¸ªé¡¹ç›®åŒ…å«å¤šä¸ªå¯ç”¨æµç¨‹æ¨¡æ¿
Kanban        â†’  -                    çœ‹æ¿æ˜¯é¡¹ç›®çš„è§†å›¾å±‚
Column        â†’  FlowStage            åˆ—å¯¹åº”æµç¨‹çš„é˜¶æ®µ
Task          â†’  FlowRun + NodeRun    ä»»åŠ¡å¯åŠ¨æ—¶åˆ›å»ºæµç¨‹å®ä¾‹
SubTask       â†’  NodeRun              å­ä»»åŠ¡å¯¹åº”æµç¨‹ä¸­çš„èŠ‚ç‚¹æ‰§è¡Œ
Label/Tag     â†’  AgentRole            æ ‡ç­¾å¯æ˜ å°„åˆ°Agentè§’è‰²
```

## 5.2 çœ‹æ¿åˆ—ä¸æµç¨‹é˜¶æ®µè‡ªåŠ¨æ˜ å°„

```yaml
# kanban-config.yaml
kanban:
  name: "å¼€å‘çœ‹æ¿"
  columns:
    - id: backlog
      name: "å¾…åŠ"
      flow_stage: null          # æœªè¿›å…¥æµç¨‹
      color: "#6B7280"

    - id: analyzing
      name: "éœ€æ±‚åˆ†æä¸­"
      flow_stage: "analyze"     # æ˜ å°„åˆ°æµç¨‹çš„åˆ†æé˜¶æ®µ
      color: "#3B82F6"
      auto_assign: true         # ä»»åŠ¡è¿›å…¥æ­¤åˆ—æ—¶è‡ªåŠ¨è§¦å‘

    - id: planning
      name: "æ–¹æ¡ˆè®¾è®¡ä¸­"
      flow_stage: "plan"
      color: "#8B5CF6"

    - id: in_progress
      name: "å¼€å‘ä¸­"
      flow_stage: "execute"
      color: "#F59E0B"

    - id: reviewing
      name: "Reviewä¸­"
      flow_stage: "review"
      color: "#EC4899"

    - id: testing
      name: "æµ‹è¯•ä¸­"
      flow_stage: "test"
      color: "#10B981"

    - id: done
      name: "å·²å®Œæˆ"
      flow_stage: "completed"
      color: "#6EE7B7"
```

å½“æµç¨‹èŠ‚ç‚¹çŠ¶æ€å˜åŒ–æ—¶ï¼Œçœ‹æ¿ä¸Šçš„Taskå¡ç‰‡è‡ªåŠ¨ç§»åŠ¨åˆ°å¯¹åº”åˆ—ã€‚

## 5.3 Task ç”Ÿå‘½å‘¨æœŸ

```
ç”¨æˆ·åˆ›å»ºTaskï¼ˆBacklogï¼‰
       â”‚
       â–¼
  ç‚¹å‡»"å¯åŠ¨ä»»åŠ¡" â”€â”€â†’ é€‰æ‹©æµç¨‹æ¨¡æ¿
       â”‚
       â–¼
  åˆ›å»º FlowRun å®ä¾‹
       â”‚
       â–¼
  æµç¨‹å¼•æ“å¼€å§‹æ‰§è¡Œ
       â”‚
       â”œâ”€â”€â†’ èŠ‚ç‚¹æ‰§è¡Œä¸­ â”€â”€â†’ Taskå¡ç‰‡è‡ªåŠ¨ç§»åŠ¨åˆ°å¯¹åº”åˆ—
       â”‚
       â”œâ”€â”€â†’ ç­‰å¾…äººå·¥ â”€â”€â†’ Taskå¡ç‰‡æ˜¾ç¤º"å¾…å¤„ç†"å¾½æ ‡
       â”‚                   å‰ç«¯æ¨é€é€šçŸ¥
       â”‚
       â”œâ”€â”€â†’ èŠ‚ç‚¹å®Œæˆ â”€â”€â†’ è‡ªåŠ¨åˆ›å»ºSubTaskè®°å½•
       â”‚                   æ›´æ–°è¿›åº¦æ¡
       â”‚
       â”œâ”€â”€â†’ æ‰“å› â”€â”€â†’ Taskå¡ç‰‡å›é€€åˆ°å¯¹åº”åˆ—
       â”‚              æ˜¾ç¤ºæ‰“å›åŸå› 
       â”‚
       â””â”€â”€â†’ æµç¨‹å®Œæˆ â”€â”€â†’ Taskç§»åŠ¨åˆ°"å·²å®Œæˆ"
                         è§¦å‘CIï¼ˆå¦‚é…ç½®ï¼‰
                         å…³è”PR
```

## 5.4 Task å¡ç‰‡ä¿¡æ¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ #14 ç»Ÿä¸€ DirEntry / AgentRole ç±»å‹å®šä¹‰  â”‚  â† æ ‡é¢˜
â”‚                                     â”‚
â”‚ ğŸ”µ In Progress                      â”‚  â† æµç¨‹é˜¶æ®µçŠ¶æ€
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 60%                      â”‚  â† æµç¨‹è¿›åº¦
â”‚                                     â”‚
â”‚ ğŸ“‹ å½“å‰èŠ‚ç‚¹: Code Review             â”‚  â† å½“å‰æ‰§è¡Œåˆ°çš„èŠ‚ç‚¹
â”‚ ğŸ¤– Agent: claude-code (code-reviewer)â”‚  â† å½“å‰Agent
â”‚ â±ï¸  å·²è€—æ—¶: 12m                      â”‚  â† æ‰§è¡Œæ—¶é—´
â”‚                                     â”‚
â”‚ ğŸ“„ äº§ç‰©: PRD v2 âœ… | Story x3 ğŸ”„     â”‚  â† å…³è”äº§ç‰©åŠçŠ¶æ€
â”‚ ğŸ”€ feat/task-14-unify-types         â”‚  â† Gitåˆ†æ”¯
â”‚ ğŸ“ PR #23                           â”‚  â† å…³è”PR
â”‚                                     â”‚
â”‚ ğŸ‘¤ frontend-dev                     â”‚  â† è´Ÿè´£äºº/Agentè§’è‰²
â”‚ ğŸ·ï¸ P1 | refactor                    â”‚  â† ä¼˜å…ˆçº§å’Œæ ‡ç­¾
â”‚                                     â”‚
â”‚ [æŸ¥çœ‹æµç¨‹] [æŸ¥çœ‹äº§ç‰©] [æŸ¥çœ‹æ—¥å¿—] [äººå·¥ä»‹å…¥] â”‚  â† æ“ä½œæŒ‰é’®
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 5.5 Git é›†æˆ

```
Task å¯åŠ¨
  â”‚
  â”œâ”€â”€â†’ è‡ªåŠ¨åˆ›å»º feature branch
  â”‚     å‘½åè§„åˆ™: feat/task-{id}-{slug}
  â”‚
  â”œâ”€â”€â†’ Agent æ‰§è¡Œæ—¶åœ¨è¯¥ branch ä¸Šæ“ä½œ
  â”‚     è‡ªåŠ¨ commitï¼ˆå¸¦è§„èŒƒåŒ– commit messageï¼‰
  â”‚
  â”œâ”€â”€â†’ Review é€šè¿‡åè‡ªåŠ¨åˆ›å»º PR
  â”‚     PR æè¿°è‡ªåŠ¨å¡«å……ï¼šéœ€æ±‚ã€Specã€å˜æ›´æ‘˜è¦
  â”‚     è‡ªåŠ¨å…³è” Taskï¼ˆé€šè¿‡ PR body ä¸­çš„ #task-idï¼‰
  â”‚
  â”œâ”€â”€â†’ æµ‹è¯•é€šè¿‡å PR æ ‡è®°ä¸º ready
  â”‚
  â””â”€â”€â†’ æœ€ç»ˆç¡®è®¤åå¯é€‰è‡ªåŠ¨ merge
       æˆ–ç­‰å¾…äººå·¥ merge

Webhook åå‘åŒæ­¥:
  GitHub/GitLab Webhook â”€â”€â†’ API Server
  - PR merged  â”€â”€â†’ æ›´æ–° Task çŠ¶æ€
  - CI passed  â”€â”€â†’ æ›´æ–°æµ‹è¯•çŠ¶æ€
  - PR comment â”€â”€â†’ åŒæ­¥åˆ° Task è¯„è®º
```

## 5.6 æ¶ˆæ¯æ—¶é—´çº¿

æ¯ä¸ªTaskéƒ½æœ‰å®Œæ•´çš„æ¶ˆæ¯æ—¶é—´çº¿ï¼ˆç±»ä¼¼å›¾ä¸­çš„Message Timelineï¼‰ï¼š

```typescript
interface TimelineEvent {
  id: string;
  taskId: string;
  flowRunId: string;
  nodeRunId?: string;
  
  type: 
    | 'agent_message'      // Agentè¾“å‡º
    | 'human_message'      // äººå·¥æ¶ˆæ¯
    | 'status_change'      // çŠ¶æ€å˜æ›´
    | 'review_action'      // Reviewæ“ä½œ
    | 'git_event'          // Gitäº‹ä»¶
    | 'system_event';      // ç³»ç»Ÿäº‹ä»¶
  
  from: {
    type: 'agent' | 'human' | 'system';
    id: string;
    name: string;
    role?: string;
  };
  
  to?: {
    type: 'agent' | 'human' | 'system';
    id: string;
    name: string;
  };
  
  content: string;
  contentType: 'text' | 'markdown' | 'json' | 'diff';
  
  metadata?: {
    tokenUsage?: { input: number; output: number };
    duration?: number;
    filesChanged?: string[];
  };
  
  timestamp: Date;
}
```

## 5.7 äº§ç‰©è¿½æº¯é“¾è·¯ï¼ˆP1-1 æ–°å¢ï¼‰

### 5.7.1 äº§ç‰©ä¸ Task çš„å…³ç³»

æ¯ä¸ª Task å¯å…³è”å¤šä¸ªäº§ç‰©ï¼ˆArtifactï¼‰ï¼Œå½¢æˆå®Œæ•´çš„è¿½æº¯é“¾ï¼š

```
éœ€æ±‚æ–‡æœ¬ (Requirement)
  â””â”€â”€derives_fromâ”€â”€â†’ PRD v1 â†’ v2 â†’ v3 (approved)
                        â””â”€â”€splits_toâ”€â”€â†’ User Story #1
                        â””â”€â”€splits_toâ”€â”€â†’ User Story #2
                        â””â”€â”€splits_toâ”€â”€â†’ User Story #3
                                          â””â”€â”€implementsâ”€â”€â†’ Task #14
                                          â””â”€â”€verifiesâ”€â”€â†’ Test Plan #1
```

### 5.7.2 äº§ç‰©åœ¨çœ‹æ¿ä¸­çš„å±•ç¤º

Task è¯¦æƒ…é¢æ¿æ–°å¢"äº§ç‰©"æ ‡ç­¾é¡µï¼š

```
â”Œâ”€ Task #14 è¯¦æƒ… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [æ—¶é—´çº¿] [æµç¨‹] [äº§ç‰©] [Git] [æ—¥å¿—]            â”‚
â”‚                                              â”‚
â”‚ ğŸ“„ å…³è”äº§ç‰©                                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ“‹ PRD: ç»Ÿä¸€ç±»å‹å®šä¹‰æ–¹æ¡ˆ                    â”‚ â”‚
â”‚ â”‚    v3 âœ… approved | è¯„åˆ†: 87/100           â”‚ â”‚
â”‚ â”‚    [æŸ¥çœ‹] [ç‰ˆæœ¬å†å²] [å¯¹æ¯”]                  â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ ğŸ“ User Story: ç»Ÿä¸€ DirEntry ç±»å‹          â”‚ â”‚
â”‚ â”‚    v1 âœ… approved                          â”‚ â”‚
â”‚ â”‚    AC: 3/3 é€šè¿‡                            â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ ğŸ§ª Test Plan: DirEntry ç±»å‹æµ‹è¯•            â”‚ â”‚
â”‚ â”‚    v1 ğŸ”„ reviewing                        â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                              â”‚
â”‚ ğŸ”— è¿½æº¯é“¾è·¯                                   â”‚
â”‚ Requirement â†’ PRD v3 â†’ Story #1 â†’ Task #14  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.7.3 äº§ç‰©ç‰ˆæœ¬å¯¹æ¯”

æ”¯æŒæŸ¥çœ‹åŒä¸€äº§ç‰©ä¸åŒç‰ˆæœ¬çš„ diffï¼Œä»¥åŠä¸åŒ Agent äº§å‡ºçš„å¯¹æ¯”ï¼ˆæ¥è‡ª collab_taskï¼‰ï¼š

```typescript
interface ArtifactDiffView {
  artifactId: string;
  leftVersion: number;   // æˆ– agent_role
  rightVersion: number;  // æˆ– agent_role
  diffType: 'version' | 'candidate';  // ç‰ˆæœ¬å¯¹æ¯” æˆ– å€™é€‰å¯¹æ¯”
  sections: DiffSection[];
}
```
