# MVP PRD 改进清单

> 记录 P1 优先级的待细化项，建议在 Phase 1 实施前完成。

---

## 1. 验收条目细化

当前验收条目多为"可正确…"，缺少可执行断言（输入/输出/失败条件），测试团队难直接落地。

建议格式：

```
功能点：创建项目和看板
  输入：项目名称、描述、Git 仓库 URL
  输出：项目 ID、默认看板 ID、4 个默认列（Backlog/In Progress/Review/Done）
  失败条件：
    - 重复项目名 → 返回 409 Conflict
    - 无效 Git URL → 返回 400 Bad Request
    - 项目名为空 → 返回 422 Validation Error
```

需要细化的验收条目：
- [ ] 创建项目和看板
- [ ] 创建 Task 并启动流程
- [ ] Agent 执行 agent_task 节点
- [ ] 人工 Review（approve/reject/edit）
- [ ] 打回机制
- [ ] 产物版本管理
- [ ] 流程模板创建
- [ ] 取消/重试/恢复流程
- [ ] Git 分支创建失败处理

---

## 2. 性能指标压测方法

当前 p95 目标缺少可复现的压测方法学。

建议补充：

| 项目 | 规格 |
|------|------|
| 环境 | 单机 8C16G，PostgreSQL 独立部署 |
| 时长 | 持续 10 分钟 |
| 数据分布 | 20 个项目，每个项目 100 个 Task |
| 预置数据 | ≥ 1 万条 timeline_events（全局） |
| 并发模型 | 20 个并发用户，每用户每秒 1 次操作 |
| 工具 | k6 或 Locust |
| 报告 | p50/p95/p99 延迟、错误率、吞吐量 |

---

## 3. 安全策略增强

当前安全边界偏黑名单思路，建议补充：

### 3.1 子进程命令白名单
- 只允许执行：`git`、`npm`、`node`、`npx`、`pnpm`
- 禁止执行：`curl`、`wget`、`ssh`、`scp`、`rm -rf /` 等危险命令
- 实现方式：Agent Adapter 层校验命令前缀

### 3.2 网络出站策略
- 禁止访问内网 IP（10.x、172.16-31.x、192.168.x）
- 允许访问：npm registry、GitHub API
- 实现方式：iptables 规则或容器网络策略

### 3.3 分支名注入防护
- 校验分支名格式：`^[a-zA-Z0-9/_-]+$`
- 禁止特殊字符：`;`、`|`、`&`、`$`、`` ` ``
- 长度限制：≤ 200 字符
- 实现方式：API 层输入校验
